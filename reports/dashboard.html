<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AWS Free Tier Dashboard</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --font-family: "Roboto Mono", monospace;
        --bg-color: #f8f9fa;
        --text-color: #212529;
        --card-bg-color: #ffffff;
        --border-color: #e9ecef;
        --primary-color: #007bff;
        --danger-color: #dc3545;
        --success-color: #28a745;
      }

      body {
        font-family: var(--font-family);
        background-color: var(--bg-color);
        color: var(--text-color);
        margin: 0;
        padding: 2rem;
        line-height: 1.5;
      }

      .container {
        max-width: 900px;
        margin: auto;
      }

      header {
        text-align: center;
        margin-bottom: 2rem;
      }

      h1 {
        font-size: 1.5rem;
        font-weight: 700;
        margin: 0;
        color: var(--primary-color);
      }

      .timestamp {
        font-size: 0.8rem;
        color: #6c757d;
      }

      .grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }

      @media (min-width: 768px) {
        .grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      .card {
        background-color: var(--card-bg-color);
        border: 1px solid var(--border-color);
        border-radius: 4px;
        padding: 1.5rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      h2 {
        font-size: 1rem;
        font-weight: 500;
        margin-top: 0;
        margin-bottom: 1rem;
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 0.5rem;
      }

      .summary-value {
        font-size: 2rem;
        font-weight: 700;
        color: var(--primary-color);
        line-height: 1;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
        font-size: 0.9rem;
      }

      th,
      td {
        text-align: left;
        padding: 0.5rem 0;
        border-bottom: 1px solid var(--border-color);
      }

      th {
        font-weight: 500;
        color: #495057;
      }

      .alert {
        padding: 0.75rem 1rem;
        margin-bottom: 1rem;
        border-radius: 4px;
        font-size: 0.9rem;
        border-left: 4px solid;
      }

      .alert-danger {
        background-color: #f8d7da;
        color: var(--danger-color);
        border-color: var(--danger-color);
      }

      .alert-success {
        background-color: #d4edda;
        color: var(--success-color);
        border-color: var(--success-color);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>AWS Free Tier Usage Monitor</h1>
        <div class="timestamp">
          Last Updated: <span id="timestamp">Loading...</span>
        </div>
      </header>

      <div class="grid">
        <div class="card">
          <h2>Total Estimated Cost</h2>
          <div class="summary-value" id="totalCost">$0.00</div>
        </div>

        <div class="card">
          <h2>Alerts</h2>
          <div id="alertsBox">
            <div class="alert alert-success">
              ‚úÖ All usage is within safe limits.
            </div>
          </div>
        </div>

        <div class="card">
          <h2>Service Cost Breakdown</h2>
          <table id="costTable">
            <thead>
              <tr>
                <th>Service</th>
                <th>Cost</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="card">
          <h2>Usage Summary</h2>
          <table id="usageTable">
            <thead>
              <tr>
                <th>Service</th>
                <th>Usage</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>

    <script>
      fetch("latest_report.json")
        .then((res) => {
          if (!res.ok) {
            throw new Error("Failed to fetch data.");
          }
          return res.json();
        })
        .then((data) => {
          document.getElementById(
            "totalCost"
          ).innerText = `$${data.total_cost.toFixed(2)}`;
          document.getElementById("timestamp").innerText = new Date(
            data.timestamp
          ).toLocaleString();

          const costBody = document.querySelector("#costTable tbody");
          costBody.innerHTML = "";
          // Fix: Iterate over the list of lists correctly
          data.cost_by_service.forEach((item) => {
            const [svc, cost] = item;
            costBody.innerHTML += `<tr><td>${svc}</td><td>$${cost.toFixed(
              2
            )}</td></tr>`;
          });

          const usageBody = document.querySelector("#usageTable tbody");
          usageBody.innerHTML = "";
          Object.entries(data.usage_data).forEach(([svc, usage]) => {
            usageBody.innerHTML += `<tr><td>${svc}</td><td>${usage}</td></tr>`;
          });

          const alerts = data.alerts;
          const alertsBox = document.getElementById("alertsBox");
          alertsBox.innerHTML = "";
          if (alerts.length) {
            alerts.forEach((alertText) => {
              alertsBox.innerHTML += `<div class="alert alert-danger">üö® ${alertText}</div>`;
            });
          } else {
            alertsBox.innerHTML = `<div class="alert alert-success">‚úÖ All usage is within safe limits.</div>`;
          }
        })
        .catch((error) => {
          console.error("Error fetching data:", error);
          const alertsBox = document.getElementById("alertsBox");
          alertsBox.innerHTML = `<div class="alert alert-danger">‚ùå Failed to load usage data.</div>`;
        });
    </script>
  </body>
</html>
